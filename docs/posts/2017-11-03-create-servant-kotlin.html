<!DOCTYPE html>
<html lang="ja">

<head profile="http://www.w3.org/2005/10/profile">
  <meta charset="utf-8">
  <link rel="icon" href="/assets/icon.jpg">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="og:title" content="Haskell の API 定義から Kotlin の関数を生成するライブラリを作った" />
  <meta property="og:site_name" content="ひげメモ" />
  <title>Haskell の API 定義から Kotlin の関数を生成するライブラリを作った</title>
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/highlight.css">
  <link rel="stylesheet" type="text/css"
    href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" />  <link rel="stylesheet" href="/css/syntax.css">
</head>

<body>
  <div class="outer">
    <header class="site-header">
      <div class="wrapper">
        <a class="site-title" href="https://matsubara0507.github.io/">ひげメモ</a>
      </div>
      <div class="header-badge">
        <a href="https://matsubara0507.github.io/">
          <img src="/assets/icon.jpg" />
        </a>
      </div>
    </header>    <div class="page-content">
      <div class="wrapper">
        <article class="post card" itemscope itemtype="http://schema.org/BlogPosting">
          <div class="card-content">
            <header class="post-header">
              <h1 class="post-title" itemprop="name headline">Haskell の API 定義から Kotlin の関数を生成するライブラリを作った</h1>
              <p class="post-meta">
                <time datetime="$time$" itemprop="datePublished">Nov  3, 2017</time>
              <div class="tags">
                <i class="fa fa-tags"></i>
                <a href="../tags/Haskell/1">Haskell</a>
                <a href="../tags/Kotlin/1">Kotlin</a>
                <a href="../tags/library/1">library</a>
              </div>
              </p>
            </header>

            <div class="post-content" itemprop="articleBody">
              <p><a href="https://hackage.haskell.org/package/servant-kotlin">servant-kotlin</a> という Haskell パッケージを作った． そん時のメモ書き．</p>
<h2 id="servant-kotlin">servant-kotlin</h2>
<p>RESTful API を型として定義できる Haskell ライブラリ <a href="https://haskell-servant.github.io">Servant</a> という Web フレームワークがある． 例えば以下のような API の型を定義できる．</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Todo</span> <span class="ot">=</span> <span class="dt">Todo</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  {<span class="ot"> todoId ::</span> <span class="dt">Int</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  ,<span class="ot"> title  ::</span> <span class="dt">Text</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  ,<span class="ot"> done   ::</span> <span class="dt">Bool</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  } <span class="kw">deriving</span> (<span class="dt">Show</span>, <span class="dt">Eq</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">ToJSON</span> <span class="dt">Todo</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> <span class="dt">CRUD</span> <span class="ot">=</span> <span class="st">&quot;todos&quot;</span> <span class="op">:&gt;</span> <span class="dt">Get</span> &#39;[<span class="dt">JSON</span>] [<span class="dt">Todo</span>]</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>       <span class="op">:&lt;|&gt;</span> <span class="st">&quot;todos&quot;</span> <span class="op">:&gt;</span> <span class="dt">ReqBody</span> &#39;[<span class="dt">JSON</span>, <span class="dt">FormUrlEncoded</span>] <span class="dt">Todo</span> <span class="op">:&gt;</span> <span class="dt">Post</span> &#39;[<span class="dt">JSON</span>] <span class="dt">Todo</span></span></code></pre></div>
<p><code>servant-kotlin</code> を用いると，上記の <code>Todo</code> 型と <code>CRUD</code> 型から以下のような Kotlin のエンドポイント関数を生成できる．</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode kotlin"><code class="sourceCode kotlin"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TodoAPI<span class="op">(</span><span class="kw">private</span> <span class="kw">val</span> <span class="va">baseURL</span><span class="op">:</span> <span class="dt">String</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">data</span> <span class="kw">class</span> Todo<span class="op">(</span><span class="kw">val</span> <span class="va">todoId</span><span class="op">:</span> <span class="dt">Int</span><span class="op">,</span> <span class="kw">val</span> <span class="va">title</span><span class="op">:</span> <span class="dt">String</span><span class="op">,</span> <span class="kw">val</span> <span class="va">done</span><span class="op">:</span> <span class="dt">Boolean</span><span class="op">)</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">fun</span> getTodos<span class="op">(</span><span class="va">handler</span><span class="op">:</span> <span class="op">(</span><span class="dt">Request</span><span class="op">,</span> <span class="dt">Response</span><span class="op">,</span> <span class="dt">Result</span>&lt;<span class="dt">List</span>&lt;<span class="dt">Todo</span>&gt;<span class="op">,</span> <span class="dt">FuelError</span>&gt;<span class="op">)</span> <span class="op">-&gt;</span> <span class="dt">Unit</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    Fuel<span class="op">.</span><span class="kw">get</span><span class="op">(</span><span class="st">&quot;/&quot;</span> <span class="op">+</span> <span class="st">&quot;todos&quot;</span><span class="op">).</span>responseObject<span class="op">(</span>handler<span class="op">)</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">fun</span> <span class="fu">postTodos</span><span class="op">(</span><span class="va">body</span><span class="op">:</span> <span class="dt">Todo</span><span class="op">,</span> <span class="va">handler</span><span class="op">:</span> <span class="op">(</span><span class="dt">Request</span><span class="op">,</span> <span class="dt">Response</span><span class="op">,</span> <span class="dt">Result</span>&lt;<span class="dt">Todo</span><span class="op">,</span> <span class="dt">FuelError</span>&gt;<span class="op">)</span> <span class="op">-&gt;</span> <span class="dt">Unit</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    Fuel<span class="op">.</span>post<span class="op">(</span><span class="st">&quot;/&quot;</span> <span class="op">+</span> <span class="st">&quot;todos&quot;</span><span class="op">).</span>body<span class="op">(</span>Gson<span class="op">().</span>toJson<span class="op">(</span>body<span class="op">,</span> Todo<span class="op">::</span><span class="kw">class</span>.java)).responseObject<span class="op">(</span><span class="va">handler</span><span class="op">)</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>同種のものに <a href="https://hackage.haskell.org/package/servant-elm"><code>servant-elm</code></a> や <a href="https://hackage.haskell.org/package/servant-ruby"><code>servant-ruby</code></a> というのがある． 今回は主に <code>servant-elm</code> と，Haskell の型定義から Elm の型定義を生成する <a href="https://hackage.haskell.org/package/elm-export"><code>elm-export</code></a> を参考して作った． 参考と言うか，ほぼ丸パクリ(笑)</p>
<h2 id="いきさつ">いきさつ</h2>
<p><a href="/post/2017-10-23-create.anaqram.html">前回の記事</a> で紹介した通り，Elm × Haskell × Kotlin の Android + Web アプリを作った． Haskell ではもちろん Servant で API をサーバーを立てて，Elm (Web UI) 側は <code>servant-elm</code> を使って API の定義から生成してたんだが，Kotlin (Android Client) 側にはそういうパッケージがまだ無い． なので作った．</p>
<h2 id="section"></h2>
<p>自分用に作ったため，ちゃんとした動作確認は自分のパターンでしかしていない． そもそも，<code>Header</code> や <code>QueryFlag</code> など，今回の要件では必要なかった部分はまだ未実装だ．</p>
<p>まぁそのうち実装します(Kotlin 側をまじめに調べてないので，どういう形に出力すればいいかを知らない...)．</p>
<h2 id="作る">作る</h2>
<h3 id="型の生成">型の生成</h3>
<p>まずは Haskell で定義した型から Kotlin の型(クラス)を生成する必要がある． 取りあえず，あらゆる Haskell の型を生成可能にする必要は無い(JSON として使えるやつだけ)ので，そういうつもりで実装する．</p>
<h2 id="section-1"></h2>
<p>Kotlin には <a href="https://kotlinlang.org/docs/reference/data-classes.html">data class</a> と呼ばれるクラスがある． 例えば，さっきの <code>Todo</code> 型に対応する data calss は以下の通り．</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode kotlin"><code class="sourceCode kotlin"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="kw">class</span> Todo<span class="op">(</span><span class="kw">val</span> <span class="va">todoId</span><span class="op">:</span> <span class="dt">Int</span><span class="op">,</span> <span class="kw">val</span> <span class="va">title</span><span class="op">:</span> <span class="dt">String</span><span class="op">,</span> <span class="kw">val</span> <span class="va">done</span><span class="op">:</span> <span class="dt">Boolean</span><span class="op">)</span></span></code></pre></div>
<p>乱暴に言えば固有のメソッドの定義が無いクラスで，ほぼほぼ C言語の構造体と同じ． Haskell のレコード型をこの data class に対応させることにした．</p>
<h2 id="section-2"></h2>
<p><code>elm-export</code> では <code>ElmType</code> 型クラスというのを定義している．</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="dt">ElmType</span> a <span class="kw">where</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ot">  toElmType ::</span> a <span class="ot">-&gt;</span> <span class="dt">ElmDatatype</span></span></code></pre></div>
<p><code>ElmDatatype</code> 型は Elm の型構造を Haskell で表現したものだ(詳しくは <a href="https://github.com/krisajenkins/elm-export/blob/94b939bb95ec4a86ae634e785ee93b66c3c1c7e6/src/Elm/Type.hs"><code>Elm/Type.hs</code></a> を見て)． これらを参考にして，Kotlin の場合も同様に <code>KotlinType</code> 型クラスと <a href="https://github.com/matsubara0507/servant-kotlin/blob/f08e3e2ae237a1c8a4931204c26bc83f03ea0e67/src/Servant/Kotlin/Type.hs#L31"><code>KotlinClass</code> 型</a>を定義した．</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="dt">KotlinType</span> a <span class="kw">where</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ot">  toKotlinType ::</span> a <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">KotlinClass</span></span></code></pre></div>
<p>Haskell の全ての型を，必ず Kotlin のクラスに変換できるとは思わなかった(例えば，フィールド名の無いフィールドを持つクラスは定義できない)ので，念のため <code>Maybe</code> を返している．</p>
<h2 id="section-3"></h2>
<p>で，まずは Primitive な Haskell 型のいくつかを <code>KotlinType</code> 型クラスのインスタンスにしてみた．</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">KotlinType</span> <span class="dt">Int</span> <span class="kw">where</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  toKotlinType _ <span class="ot">=</span> <span class="dt">Just</span> <span class="op">$</span> <span class="dt">PrimitiveClass</span> <span class="dt">KInt</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">KotlinType</span> () <span class="kw">where</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  toKotlinType _ <span class="ot">=</span> <span class="dt">Just</span> <span class="op">$</span> <span class="dt">PrimitiveClass</span> <span class="dt">KUnit</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">KotlinType</span> <span class="dt">Text</span> <span class="kw">where</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  toKotlinType _ <span class="ot">=</span> <span class="dt">Just</span> <span class="op">$</span> <span class="dt">PrimitiveClass</span> <span class="dt">KString</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">KotlinType</span> a <span class="ot">=&gt;</span> <span class="dt">KotlinType</span> [a] <span class="kw">where</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  toKotlinType _ <span class="ot">=</span> <span class="dt">ExClass</span> <span class="op">.</span> <span class="dt">KList</span> <span class="op">&lt;$&gt;</span> toKotlinType (<span class="dt">Proxy</span><span class="ot"> ::</span> <span class="dt">Proxy</span> a)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">KotlinType</span> a <span class="ot">=&gt;</span> <span class="dt">KotlinType</span> (<span class="dt">Maybe</span> a) <span class="kw">where</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  toKotlinType _ <span class="ot">=</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">PrimitiveClass</span> <span class="op">.</span> <span class="dt">KNullable</span> <span class="op">&lt;$&gt;</span> toKotlinType (<span class="dt">Proxy</span><span class="ot"> ::</span> <span class="dt">Proxy</span> a)</span></code></pre></div>
<p>文字列とか配列・リストの辺りは，本当にこんな定義でいいかは怪しいが，あんまり悩んでてもしょうがないので，暫定的にこのような定義にしてる．</p>
<p>ちなみに，Kotlin には <code>Maybe</code> や <code>Optional</code> のようなコンテナ型は無く，Nullable というモノを用いている． <code>A</code> 型の Nullable は <code>A?</code> と書くのだ．</p>
<h3 id="generics">Generics</h3>
<p>さて，最悪これでお終いでも良いのだが，<code>deriving</code> ができないと流石に使いにくい． なので，頑張って Generics を定義する(とはいえ，<code>elm-export</code> のを真似るだけだが)．</p>
<h2 id="section-4"></h2>
<p>Generics とは，乱暴な言い方をすると，Haskell の型構造を Haskell の型と型クラスで表現したものだ． もっと細かい情報が含まれてるとはいえ，<code>elm-export</code> の <code>ElmDatatype</code> 型と <code>ElmType</code> 型クラスや，今回の <code>KotlinClass</code> 型と <code>KotlinType</code> 型クラスにイメージは似ている(もちろんもっと精巧に作られているが)．</p>
<p><code>deriving</code> で任意の型を <code>Generic</code> 型クラスのインスタンスにできる(個人的にはココがすごい)ので，<code>Generic</code> 型クラスのインスタンスに対する default 実装を与えておけば良いのだ．</p>
<h2 id="section-5"></h2>
<p><code>Generic</code> 型クラスは次のような定義になっている．</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="dt">Generic</span> a <span class="kw">where</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">type</span> <span class="dt">Rep</span><span class="ot"> a ::</span> <span class="op">*</span> <span class="ot">-&gt;</span> <span class="op">*</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="ot">  from  ::</span> a <span class="ot">-&gt;</span> (<span class="dt">Rep</span> a) x</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="ot">  to    ::</span> (<span class="dt">Rep</span> a) x <span class="ot">-&gt;</span> a</span></code></pre></div>
<p><code>Rep a x</code> という型が Haskell の型構造を表現した型だ(<code>x</code> があるのは再帰的に構造をラップするためだと思う)． 例えば <code>Bool</code> の <code>Rep a x</code> 型を見てみる．</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;&gt;</span> from (<span class="dt">True</span><span class="ot"> ::</span> <span class="dt">Bool</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="dt">M1</span> {unM1 <span class="ot">=</span> <span class="dt">R1</span> (<span class="dt">M1</span> {unM1 <span class="ot">=</span> <span class="dt">U1</span>})}</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;&gt;</span> <span class="op">:</span>t from (<span class="dt">True</span><span class="ot"> ::</span> <span class="dt">Bool</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>from (<span class="dt">True</span><span class="ot"> ::</span> <span class="dt">Bool</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="ot">  ::</span> <span class="dt">D1</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>       (<span class="dt">&#39;MetaData</span> <span class="st">&quot;Bool&quot;</span> <span class="st">&quot;GHC.Types&quot;</span> <span class="st">&quot;ghc-prim&quot;</span> <span class="dt">&#39;False</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>       (<span class="dt">C1</span> (<span class="dt">&#39;MetaCons</span> <span class="st">&quot;False&quot;</span> <span class="dt">&#39;PrefixI</span> <span class="dt">&#39;False</span>) <span class="dt">U1</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">:+:</span> <span class="dt">C1</span> (<span class="dt">&#39;MetaCons</span> <span class="st">&quot;True&quot;</span> <span class="dt">&#39;PrefixI</span> <span class="dt">&#39;False</span>) <span class="dt">U1</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>       x</span></code></pre></div>
<p>なので，<code>Rep a x</code> 型に対しての <code>KotlinType</code> 型クラスのための型クラス <code>GenericKotlinType</code> を定義する．</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="dt">KotlinType</span> a <span class="kw">where</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="ot">  toKotlinType ::</span> a <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">KotlinClass</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  toKotlinType <span class="ot">=</span> genericToKotlinType <span class="op">.</span> from</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  default<span class="ot"> toKotlinType ::</span> (<span class="dt">Generic</span> a, <span class="dt">GenericKotlinType</span> (<span class="dt">Rep</span> a)) <span class="ot">=&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    a <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">KotlinClass</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="dt">GenericKotlinType</span> f <span class="kw">where</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="ot">  genericToKotlinType ::</span> f a <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">KotlinClass</span></span></code></pre></div>
<h2 id="section-6"></h2>
<p>あとは，各データ構造の型(e.g. <code>D1</code> や <code>(:+:)</code>)ごとにインスタンスを定義してあげれば良い．</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> (<span class="dt">Datatype</span> d, <span class="dt">GenericKotlinFields</span> f)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="ot">=&gt;</span> <span class="dt">GenericKotlinType</span> (<span class="dt">D1</span> d f) <span class="kw">where</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  genericToKotlinType datatype <span class="ot">=</span> <span class="fu">fmap</span> <span class="dt">DataClass</span> <span class="op">$</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">KotlinDataClass</span> (<span class="fu">pack</span> <span class="op">$</span> datatypeName datatype)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;$&gt;</span> genericToKotlinFields (unM1 datatype)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- Kotlin のインスタンスフィールを返す型クラス</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="dt">GenericKotlinFields</span> f <span class="kw">where</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="ot">  genericToKotlinFields ::</span> f a <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">KotlinFields</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> (<span class="dt">Selector</span> s, <span class="dt">GenericKotlinType</span> a)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="ot">=&gt;</span> <span class="dt">GenericKotlinFields</span> (<span class="dt">S1</span> s a) <span class="kw">where</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  genericToKotlinFields selector <span class="ot">=</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">case</span> selName selector <span class="kw">of</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;&quot;</span>   <span class="ot">-&gt;</span> <span class="dt">Nothing</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>      name <span class="ot">-&gt;</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">Node</span> <span class="op">.</span> <span class="dt">KotlinField</span> (<span class="fu">pack</span> name)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>          <span class="op">&lt;$&gt;</span> genericToKotlinType (<span class="fu">undefined</span><span class="ot"> ::</span> a p)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">GenericKotlinFields</span> (f <span class="op">:+:</span> g) <span class="kw">where</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  genericToKotlinFields _ <span class="ot">=</span> <span class="dt">Nothing</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> (<span class="dt">GenericKotlinFields</span> f, <span class="dt">GenericKotlinFields</span> g)</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  <span class="ot">=&gt;</span> <span class="dt">GenericKotlinFields</span> (f <span class="op">:*:</span> g) <span class="kw">where</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  genericToKotlinFields _ <span class="ot">=</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Brunch</span> <span class="op">&lt;$&gt;</span> genericToKotlinFields (<span class="fu">undefined</span><span class="ot"> ::</span> f p)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>           <span class="op">&lt;*&gt;</span> genericToKotlinFields (<span class="fu">undefined</span><span class="ot"> ::</span> g p)</span></code></pre></div>
<p>ちなみに <code>D1 d f</code> 型は datatype を，<code>S1 s a</code> 型はレコード型のフィールドを，<code>f :+: g</code> 型は直和型を，<code>f :*: g</code> 型は直積型を表している．</p>
<h3 id="servant-api-の型の変換">Servant API の型の変換</h3>
<p>最初に定義した Servant API の型では(書きやすいけど)扱いにくいので，変換する部分が必要だ． もちろん，Servant 側が型クラスとして定義してある．</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="dt">HasForeign</span> lang ftype (<span class="ot">api ::</span> <span class="op">*</span>) <span class="kw">where</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">type</span> <span class="dt">Foreign</span> ftype<span class="ot"> api ::</span> <span class="op">*</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="ot">  foreignFor ::</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Proxy</span> lang</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">-&gt;</span> <span class="dt">Proxy</span> ftype</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="ot">-&gt;</span> <span class="dt">Proxy</span> api</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">-&gt;</span> <span class="dt">Req</span> ftype</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">-&gt;</span> <span class="dt">Foreign</span> ftype api</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="ot">listFromAPI ::</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  ( <span class="dt">HasForeign</span> lang ftype api</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  , <span class="dt">GenerateList</span> ftype (<span class="dt">Foreign</span> ftype api)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="ot">=&gt;</span> <span class="dt">Proxy</span> lang</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="ot">-&gt;</span> <span class="dt">Proxy</span> ftype</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="ot">-&gt;</span> <span class="dt">Proxy</span> api</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="ot">-&gt;</span> [<span class="dt">Req</span> ftype]</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>listFromAPI <span class="ot">=</span> <span class="op">...</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="dt">HasForeignType</span> lang ftype a <span class="kw">where</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="ot">  typeFor ::</span> <span class="dt">Proxy</span> lang <span class="ot">-&gt;</span> <span class="dt">Proxy</span> ftype <span class="ot">-&gt;</span> <span class="dt">Proxy</span> a <span class="ot">-&gt;</span> ftype</span></code></pre></div>
<p><code>listFromAPI</code> 関数を使うことでメタ情報の載った API の型 <code>Req ftype</code> の値が手に入る． 重要なのは <code>HasForeign</code> 型クラスだが，インスタンスが既にかなり定義されていて，実質的には <code>HasForeignType</code> 型クラスの<a href="https://github.com/matsubara0507/servant-kotlin/blob/f08e3e2ae237a1c8a4931204c26bc83f03ea0e67/src/Servant/Kotlin/Internal/Foreign.hs">インスタンスを定義</a>すれば良い．</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">LangKotlin</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> (<span class="dt">KotlinType</span> a) <span class="ot">=&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">HasForeignType</span> <span class="dt">LangKotlin</span> <span class="dt">KotlinClass</span> a <span class="kw">where</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  typeFor _ _ _ <span class="ot">=</span> toKotlinType&#39; (<span class="dt">Proxy</span><span class="ot"> ::</span> <span class="dt">Proxy</span> a)</span></code></pre></div>
<h3 id="生成する">生成する</h3>
<p>さて，後は実際に Kotlin のコードを文字列として生成する部分を作る． しかし，この部分は泥臭い部分なので細かくは説明しないでおく． <code>servant-elm</code> と見比べながら書き直していった．</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- generate types</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="dt">GenerateKotlin</span> a <span class="kw">where</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="ot">  generateKotlin ::</span> a <span class="ot">-&gt;</span> [<span class="dt">Text</span>]</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">GenerateKotlin</span> <span class="dt">KotlinPrimitiveClass</span> <span class="kw">where</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  generateKotlin <span class="dt">KDouble</span> <span class="ot">=</span> [<span class="st">&quot;Double&quot;</span>]</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  generateKotlin <span class="dt">KFloat</span>  <span class="ot">=</span> [<span class="st">&quot;Float&quot;</span>]</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co">-- generate apis</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="ot">generateKotlinForAPIWith ::</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  ( <span class="dt">F.HasForeign</span> <span class="dt">LangKotlin</span> <span class="dt">KotlinClass</span> api</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  , <span class="dt">F.GenerateList</span> <span class="dt">KotlinClass</span> (<span class="dt">F.Foreign</span> <span class="dt">KotlinClass</span> api))</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="ot">=&gt;</span> <span class="dt">KotlinOptions</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="ot">-&gt;</span> <span class="dt">Proxy</span> api</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="ot">-&gt;</span> [<span class="dt">Text</span>]</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>generateKotlinForAPIWith opts <span class="ot">=</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  nub <span class="op">.</span> <span class="fu">fmap</span> (docToText <span class="op">.</span> generateKotlinForRequest opts) <span class="op">.</span> getEndpoints</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="ot">generateKotlinForRequest ::</span> <span class="dt">KotlinOptions</span> <span class="ot">-&gt;</span> <span class="dt">F.Req</span> <span class="dt">KotlinClass</span> <span class="ot">-&gt;</span> <span class="dt">Doc</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>generateKotlinForRequest <span class="ot">=</span> <span class="op">...</span></span></code></pre></div>
<p><code>Doc</code> 型というのを使ってる． これは <a href="https://hackage.haskell.org/package/wl-pprint-text"><code>wl-pprint-text</code></a> というパッケージのモノで，直接文字列方を使うのではなく，この <code>Doc</code> 型を使うことでインデントなどをいい感じにしてくれる．</p>
<h2 id="section-7"></h2>
<p>Elm との違いは，最終的な出力をいじる所． Elm (や Haskell) はトップレベルのインデント(関数や型定義)は揃ってるので，そのままでいいのだが，OOP 言語はクラスにラップする必要があるのでめんどくさい．</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ot">generateKotlinForAPIClass ::</span> <span class="dt">Text</span> <span class="ot">-&gt;</span> [<span class="dt">Text</span>] <span class="ot">-&gt;</span> [<span class="dt">Text</span>]</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>generateKotlinForAPIClass className body <span class="ot">=</span> <span class="fu">mconcat</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  [ [ docToText <span class="op">$</span> <span class="st">&quot;class&quot;</span> <span class="op">&lt;+&gt;</span> textStrict className <span class="op">&lt;&gt;</span> <span class="st">&quot;(private val baseURL: String) {&quot;</span> ]</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  , <span class="fu">fmap</span> (docToText <span class="op">.</span> vsep <span class="op">.</span> <span class="fu">fmap</span> (indent indentNum <span class="op">.</span> textStrict) <span class="op">.</span> T.lines) body</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  , [ <span class="st">&quot;}&quot;</span> ]</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  ]</span></code></pre></div>
<p>めんどくさかったので，一度 <code>Doc</code> 型に戻してからインデントをそろえて，<code>Text</code> 型に直して返している(効率悪そう...)．</p>
<h3 id="ファイルへ出力">ファイルへ出力</h3>
<p>最後にファイルへ出力する部分を書く． <code>Spec</code> という名前はどうかと思うんだけど...(<code>elm-export</code> がそうしてる)．</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Spec</span> <span class="ot">=</span> <span class="dt">Spec</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  {<span class="ot"> namespace    ::</span> [<span class="dt">Text</span>]</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  ,<span class="ot"> filename     ::</span> <span class="dt">Text</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  ,<span class="ot"> declarations ::</span> [<span class="dt">Text</span>]</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  } <span class="kw">deriving</span> (<span class="dt">Show</span>)</span></code></pre></div>
<p>というの定義して，この内容から出力している． <code>declarations</code> というのが，<code>generateKotlinForAPIClass</code> 関数などで出力した値を渡す．</p>
<h2 id="完成">完成</h2>
<p>こんな風な <code>Main</code> を書くと生成できる．</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ot">spec ::</span> <span class="dt">Spec</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>spec <span class="ot">=</span> <span class="dt">Spec</span> [<span class="st">&quot;com&quot;</span>, <span class="st">&quot;github&quot;</span>, <span class="st">&quot;matsubara0507&quot;</span>] <span class="st">&quot;TodoAPI&quot;</span> <span class="op">$</span> <span class="fu">mconcat</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  [ [ defKotlinImports ]</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  , generateKotlinForAPIClass <span class="st">&quot;TodoAPI&quot;</span> <span class="op">$</span> <span class="fu">mconcat</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>      [ generateKotlinForDefDataClass (<span class="dt">Proxy</span><span class="ot"> ::</span> <span class="dt">Proxy</span> <span class="dt">Todo</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>      , generateKotlinForAPI (<span class="dt">Proxy</span><span class="ot"> ::</span> <span class="dt">Proxy</span> <span class="dt">CRUD</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="ot">main ::</span> <span class="dt">IO</span> ()</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  specsToDir [spec] <span class="st">&quot;example/src/main/java&quot;</span></span></code></pre></div>
<h3 id="stackage">Stackage</h3>
<p>出来上がったので</p>
<ol>
<li>PVP (依存パッケージのバージョン)を適当に指定して</li>
<li>Hackage にアップロードして</li>
<li><code>servant-elm</code> を参考にして<a href="https://github.com/matsubara0507/servant-kotlin/blob/f08e3e2ae237a1c8a4931204c26bc83f03ea0e67/test/Servant/Kotlin/Internal/GenerateSpec.hs">テストを追加</a>し</li>
<li>Stackage に <a href="https://github.com/fpco/stackage/pull/2987">PR</a> を出して</li>
</ol>
<p>無事 Stack の <a href="https://www.stackage.org/nightly-2017-10-28/package/servant-kotlin-0.1.0.0">Nightly</a> に登録された！</p>
<h3 id="サンプル">サンプル</h3>
<p>ちなみに，サンプルは GitHub にあげてある．</p>
<p>この <a href="https://github.com/matsubara0507/servant-kotlin/blob/f08e3e2ae237a1c8a4931204c26bc83f03ea0e67/example/Generater.hs">Haskell コード</a>から，この <a href="https://github.com/matsubara0507/servant-kotlin/blob/f08e3e2ae237a1c8a4931204c26bc83f03ea0e67/example/src/main/java/com/github/matsubara0507/TodoAPI.kt">Kotlin コード</a>を生成する．</p>
<h2 id="おしまい">おしまい</h2>
<p>Generics は使ってみると，意外と分かりやすいですね． ただ，これでいいんだろうか...という不安は付いて回りますが(笑)</p>
            </div>

            <footer class="post-footer">
              <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button"
                data-show-count="false">Tweet</a>
              <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
            </footer>
          </div>
        </article>
      </div>
    </div>
    <footer class="site-footer">
      <div class="wrapper">
        <span class="footer-heading">ひげメモ</span>
      </div>
      <div class="page-content card" style="display: flex; justify-content: center; padding: 5px 0px">
        <a href="https://haskell.jp/blog/posts/links.html#matsubara0507.github.io">
          <img width="234" src="https://haskell.jp/img/supported-by-haskell-jp.svg" alt="Supported By Haskell-jp.">
        </a>
      </div>
    </footer>  </div>
</body>