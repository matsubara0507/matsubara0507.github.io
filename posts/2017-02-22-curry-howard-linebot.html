<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html>
<html lang="ja">

  <head>
  <meta charset="utf-8">
  <link rel="icon" href="../assets/icon.jpg">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
    
      <meta property="og:title" content="Haskell で LINE Bot を作った" />
    
  

  <meta property="og:site_name" content="ひげメモ" />

  

  
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-86386380-1', 'auto');
  ga('send', 'pageview');
</script>

  

  <title>
    
      
        Haskell で LINE Bot を作った
      
    
  </title>

  <link rel="stylesheet" href="../css/main.css">
  <link rel="stylesheet" href="../css/highlight.css">
  <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" />
</head>


  <body>
      <div class="outer">

        <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="https://matsubara0507.github.io/">ひげメモ</a>

  </div>

  <div class="header-badge">
    <a href="https://matsubara0507.github.io/">
        <img src="../assets/icon.jpg" />
    </a>
  </div>

</header>


        <div class="page-content">
          <div class="wrapper">
            <article class="post card" itemscope itemtype="http://schema.org/BlogPosting">
 <div class="card-content">
  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Haskell で LINE Bot を作った</h1>
    <p class="post-meta">
      <time datetime="2017-02-22" itemprop="datePublished">
        Feb 22, 2017
      </time>
      
    </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>GitHub で <strong>LINE Messaging API の <a href="https://github.com/noraesae/line">Haskell 版 SDK</a> があった</strong> ので作ってみた． リポジトリは<a href="https://github.com/matsubara0507/curry-howard-linebot">こちら</a>．</p>
<p>Bot の友達登録も README に載せたんでそっちからどーぞ．</p>
<h2 id="いきさつ">いきさつ</h2>
<p>先日行ってきた，エンジニアMEETUP!!で発表する用に，何かネタ感のあることをしたかった．</p>
<p>最初は LINE BOT AWARD 用に作った Score Bot の話をしようかと思ったが，話が普通すぎるので，他に何か面白そうなのが無いかを考えた結果．</p>
<h2 id="どんな-bot-か">どんな Bot か</h2>
<p>Bot 自体の機能は <strong>どーでもよかった</strong> ので適当に考える． Haskell にあやかって，Curry-Howard 同型対応を返す Bot にすることにした． 「型付きラムダ計算」って送ると「自然演繹」と返ってくるイメージ．</p>
<p>しょうもない．</p>
<h2 id="環境">環境</h2>
<h3 id="開発環境">開発環境</h3>
<p>貧乏学生なので Heroku を使おう．</p>
<ul>
<li>Windows 10 Home</li>
<li>Haskell Stack LTS 8.1 (GHC 8.02)</li>
<li>Heroku (<a href="https://github.com/mfine/heroku-buildpack-stack">stack の buildpack</a> を使う)</li>
</ul>
<h3 id="依存ライブラリ">依存ライブラリ</h3>
<p>下の2つだけ</p>
<ul>
<li>Haskell SDK for LINE Messaging API
<ul>
<li><a href="https://github.com/noraesae/line">github.com/noraesae/line</a></li>
</ul></li>
<li>Haskell Web Application Interface
<ul>
<li><a href="https://github.com/yesodweb/wai">github.com/yesodweb/wai</a></li>
</ul></li>
</ul>
<p>と，Heroku で Haskell を build するための buildpack．</p>
<ul>
<li>Heroku buildpack for Haskell Stack
<ul>
<li><a href="https://github.com/mfine/heroku-buildpack-stack">github.com/mfine/heroku-buildpack-stack</a></li>
</ul></li>
</ul>
<p>Haskell on Heroku というのもあったが，S3がどーのこーのとめんどくさそうだったので，まずは簡単そうなこっちでやってみた． で，うまくいったのでこの buildpack で十分．</p>
<h2 id="実装">実装</h2>
<h3 id="stack-と-リポジトリの準備">stack と リポジトリの準備</h3>
<p>余計かな．</p>
<pre><code>$ stack new curry-howard-linebot
$ git init</code></pre>
<p>不必要なのが多いので cabal ファイルを編集し，要らんコードを削除．</p>
<pre><code>executable curry-howard-linebot-exe
  hs-source-dirs:      app
  main-is:             Main.hs
  ghc-options:         -threaded -rtsopts -with-rtsopts=-N
  build-depends:       base
                     , line
                     , text
                     , wai
                     , warp
  default-language:    Haskell2010

source-repository head
  type:     git
  location: https://github.com/matsubara0507/curry-howard-linebot</code></pre>
<h3 id="echo-bot">echo bot</h3>
<p>まずはテストがてら echo bot を作った．</p>
<p>その時のソースコードは<a href="https://github.com/matsubara0507/curry-howard-linebot">コチラ</a>．</p>
<p>Haskell SDK にある <a href="https://github.com/noraesae/line/tree/master/examples">sample コード</a> が一応 echo bot を作るための handler になってるっぽい． ので，それを参考にしながら，<code>main</code> を補い，不必要な部分は削除して書いた．</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="ot">{-# LANGUAGE OverloadedStrings #-}</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="kw">module</span> <span class="dt">Main</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="kw">import</span> <span class="dt">Control.Monad</span> (forM_)</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="kw">import</span> <span class="dt">Data.Maybe</span>(fromJust)</a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="kw">import</span> <span class="kw">qualified</span> <span class="dt">Data.Text</span> <span class="kw">as</span> <span class="dt">T</span> (<span class="dt">Text</span>, pack, unpack)</a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="kw">import</span> <span class="dt">Line.Messaging.API</span> ( <span class="dt">APIIO</span>, <span class="dt">APIError</span>, <span class="dt">ChannelSecret</span>, <span class="dt">ChannelAccessToken</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9">                          , <span class="dt">Message</span>(<span class="fu">..</span>), runAPI, reply)</a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="kw">import</span> <span class="dt">Line.Messaging.Webhook</span> ( <span class="dt">Event</span>(..), <span class="dt">EventMessage</span>(..), <span class="dt">ReplyToken</span>(..)</a>
<a class="sourceLine" id="cb3-11" data-line-number="11">                              , <span class="dt">ReplyableEvent</span>(<span class="fu">..</span>), webhookApp</a>
<a class="sourceLine" id="cb3-12" data-line-number="12">                              , defaultOnFailure, getMessage, getReplyToken)</a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="kw">import</span> <span class="dt">Line.Messaging.Types</span> (<span class="dt">Text</span>(..))</a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="kw">import</span> <span class="dt">Network.Wai</span> (<span class="dt">Application</span>)</a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="kw">import</span> <span class="dt">Network.Wai.Handler.Warp</span> (run)</a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="kw">import</span> <span class="dt">System.Environment</span> (lookupEnv)</a>
<a class="sourceLine" id="cb3-17" data-line-number="17"></a>
<a class="sourceLine" id="cb3-18" data-line-number="18"><span class="ot">main ::</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb3-19" data-line-number="19">main <span class="fu">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb3-20" data-line-number="20">  port <span class="ot">&lt;-</span> maybe <span class="dv">8080</span> read <span class="fu">&lt;$&gt;</span> lookupEnv <span class="st">&quot;PORT&quot;</span><span class="ot"> ::</span> <span class="dt">IO</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb3-21" data-line-number="21">  run port app</a>
<a class="sourceLine" id="cb3-22" data-line-number="22"></a>
<a class="sourceLine" id="cb3-23" data-line-number="23"><span class="ot">getChannelSecret ::</span> <span class="dt">IO</span> <span class="dt">ChannelSecret</span></a>
<a class="sourceLine" id="cb3-24" data-line-number="24">getChannelSecret <span class="fu">=</span> T.pack <span class="fu">.</span> fromJust <span class="fu">&lt;$&gt;</span> lookupEnv <span class="st">&quot;CHANNEL_SECRET&quot;</span></a>
<a class="sourceLine" id="cb3-25" data-line-number="25"></a>
<a class="sourceLine" id="cb3-26" data-line-number="26"><span class="ot">getChannelToken ::</span> <span class="dt">IO</span> <span class="dt">ChannelAccessToken</span></a>
<a class="sourceLine" id="cb3-27" data-line-number="27">getChannelToken <span class="fu">=</span> T.pack <span class="fu">.</span> fromJust <span class="fu">&lt;$&gt;</span> lookupEnv <span class="st">&quot;CHANNEL_TOKEN&quot;</span></a>
<a class="sourceLine" id="cb3-28" data-line-number="28"></a>
<a class="sourceLine" id="cb3-29" data-line-number="29"><span class="co">-- | A WAI application to handle webhook requests.</span></a>
<a class="sourceLine" id="cb3-30" data-line-number="30"><span class="ot">app ::</span> <span class="dt">Application</span></a>
<a class="sourceLine" id="cb3-31" data-line-number="31">app req f <span class="fu">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb3-32" data-line-number="32">  channelSecret <span class="ot">&lt;-</span> getChannelSecret</a>
<a class="sourceLine" id="cb3-33" data-line-number="33">  webhookApp channelSecret handler defaultOnFailure req f</a>
<a class="sourceLine" id="cb3-34" data-line-number="34"></a>
<a class="sourceLine" id="cb3-35" data-line-number="35"><span class="ot">handler ::</span> [<span class="dt">Event</span>] <span class="ot">-&gt;</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb3-36" data-line-number="36">handler events <span class="fu">=</span> forM_ events handleEvent</a>
<a class="sourceLine" id="cb3-37" data-line-number="37"></a>
<a class="sourceLine" id="cb3-38" data-line-number="38"><span class="ot">handleEvent ::</span> <span class="dt">Event</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb3-39" data-line-number="39">handleEvent (<span class="dt">MessageEvent</span> event) <span class="fu">=</span> handleMessageEvent event</a>
<a class="sourceLine" id="cb3-40" data-line-number="40">handleEvent _ <span class="fu">=</span> return ()</a>
<a class="sourceLine" id="cb3-41" data-line-number="41"></a>
<a class="sourceLine" id="cb3-42" data-line-number="42"><span class="ot">handleMessageEvent ::</span> <span class="dt">ReplyableEvent</span> <span class="dt">EventMessage</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb3-43" data-line-number="43">handleMessageEvent event <span class="fu">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb3-44" data-line-number="44">  <span class="kw">case</span> getMessage event <span class="kw">of</span></a>
<a class="sourceLine" id="cb3-45" data-line-number="45">    <span class="dt">TextEM</span> _ (<span class="dt">Text</span> text) <span class="ot">-&gt;</span> echo (getReplyToken event) text</a>
<a class="sourceLine" id="cb3-46" data-line-number="46">    _ <span class="ot">-&gt;</span> echo (getReplyToken event) <span class="st">&quot;undefined message&quot;</span></a>
<a class="sourceLine" id="cb3-47" data-line-number="47"></a>
<a class="sourceLine" id="cb3-48" data-line-number="48"><span class="ot">api ::</span> <span class="dt">APIIO</span> a <span class="ot">-&gt;</span> <span class="dt">IO</span> (<span class="dt">Either</span> <span class="dt">APIError</span> a)</a>
<a class="sourceLine" id="cb3-49" data-line-number="49">api <span class="fu">=</span> runAPI getChannelToken</a>
<a class="sourceLine" id="cb3-50" data-line-number="50"></a>
<a class="sourceLine" id="cb3-51" data-line-number="51"><span class="ot">echo ::</span> <span class="dt">ReplyToken</span> <span class="ot">-&gt;</span> <span class="dt">T.Text</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb3-52" data-line-number="52">echo replyToken content <span class="fu">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb3-53" data-line-number="53">  api <span class="fu">$</span> reply replyToken [ <span class="dt">Message</span> <span class="fu">.</span> <span class="dt">Text</span> <span class="fu">$</span> content ]</a>
<a class="sourceLine" id="cb3-54" data-line-number="54">  return ()</a></code></pre></div>
<p>LINE Bot に webhook するためにはシークレットキーが必要で，API を叩くためにはAPIトークンが必要． どちらも，環境変数から取ってきたかったので <code>loohupEnv</code> で取ってきている． エラー処理も何もしていないので，改善の余地ありですね． <code>ChannelSecret</code> 型も <code>ChannelAccessToken</code> 型も一般的な <code>Text</code> 型(lineライブラリには別の意味の <code>Text</code> 型があるので注意)のエイリアスなので，<code>T.pack</code> して変換してる．</p>
<p>他は，まぁ，Haskell で Web 系のアプリ書くと，こうなるんだろーなという感じに書いてある(サンプルそのまんま)．</p>
<h3 id="bot-の準備">Bot の準備</h3>
<p><a href="https://business.line.me/ja/services/bot">LINE Bot のアカウント</a>の取得と <a href="https://www.heroku.com/">Heroku アプリ</a>を作成． それぞれ公式サイトでカチカチやってればできるはず(ないしはググれば腐るほど出てくる)．</p>
<p>カチカチして Heroku アプリを作った場合は，まずはリポジトリにリモート設定する．</p>
<pre><code>$ heroku git:remote -a &lt;app-name&gt;</code></pre>
<p>次に buildpack を設定．</p>
<pre><code>$ heroku buildpacks:set https://github.com/mfine/heroku-buildpack-stack</code></pre>
<p>そしたら後はデプロイするだけ．</p>
<pre><code>$ git push heroku master</code></pre>
<p>初めは時間がかかるけど，無事にビルド出来るはず．</p>
<h3 id="curry-howard-同型対応を返す">Curry-Howard 同型対応を返す</h3>
<p>データベースをいじるのはめんどくさいのでハードコーディング．</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="ot">curryHowardCorrespondence ::</span> [([<span class="dt">Text</span>], [<span class="dt">Text</span>], <span class="dt">URL</span>)]</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">curryHowardCorrespondence <span class="fu">=</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3">  [ ( [<span class="st">&quot;Natural Deducation&quot;</span>, <span class="st">&quot;自然演繹&quot;</span>]</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">    , [<span class="st">&quot;Typed Lambda Calclus&quot;</span>, <span class="st">&quot;型付きラムダ計算&quot;</span>, <span class="st">&quot;単純型付きラムダ計算&quot;</span>, <span class="st">&quot;型付きλ計算&quot;</span>, <span class="st">&quot;単純型付きλ計算&quot;</span>]</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">    , <span class="st">&quot;http://disi.unitn.it/~bernardi/RSISE11/Papers/curry-howard.pdf&quot;</span>)</a>
<a class="sourceLine" id="cb7-6" data-line-number="6">  , ( [<span class="st">&quot;Sequent Calculus&quot;</span>, <span class="st">&quot;シーケント計算&quot;</span>]</a>
<a class="sourceLine" id="cb7-7" data-line-number="7">    , [<span class="st">&quot;Typed Lambda Calclus&quot;</span>, <span class="st">&quot;型付きラムダ計算&quot;</span>, <span class="st">&quot;単純型付きラムダ計算&quot;</span>, <span class="st">&quot;型付きλ計算&quot;</span>, <span class="st">&quot;単純型付きλ計算&quot;</span>]</a>
<a class="sourceLine" id="cb7-8" data-line-number="8">    , <span class="st">&quot;http://disi.unitn.it/~bernardi/RSISE11/Papers/curry-howard.pdf&quot;</span>)</a>
<a class="sourceLine" id="cb7-9" data-line-number="9">  , ( [<span class="st">&quot;System F&quot;</span>]</a>
<a class="sourceLine" id="cb7-10" data-line-number="10">    , [<span class="st">&quot;Polymorphic Lambda Calculus&quot;</span>, <span class="st">&quot;2階ラムダ計算&quot;</span>, <span class="st">&quot;多相ラムダ計算&quot;</span>, <span class="st">&quot;2階λ計算&quot;</span>, <span class="st">&quot;多相λ計算&quot;</span>]</a>
<a class="sourceLine" id="cb7-11" data-line-number="11">    , <span class="st">&quot;http://disi.unitn.it/~bernardi/RSISE11/Papers/curry-howard.pdf&quot;</span>)</a>
<a class="sourceLine" id="cb7-12" data-line-number="12">  , ( [<span class="st">&quot;Modal Logic&quot;</span>, <span class="st">&quot;様相論理&quot;</span>]</a>
<a class="sourceLine" id="cb7-13" data-line-number="13">    , [<span class="st">&quot;Mondad&quot;</span>, <span class="st">&quot;モナド&quot;</span>]</a>
<a class="sourceLine" id="cb7-14" data-line-number="14">    , <span class="st">&quot;http://www.sciencedirect.com/science/article/pii/S0304397596001697&quot;</span>)</a>
<a class="sourceLine" id="cb7-15" data-line-number="15">  , ( [<span class="st">&quot;Linear Logic&quot;</span>, <span class="st">&quot;線形論理&quot;</span>]</a>
<a class="sourceLine" id="cb7-16" data-line-number="16">    , [<span class="st">&quot;Session Type&quot;</span>, <span class="st">&quot;セッション型&quot;</span>]</a>
<a class="sourceLine" id="cb7-17" data-line-number="17">    , <span class="st">&quot;http://ctp.di.fct.unl.pt/~btoninho/mscs12.pdf&quot;</span>)</a>
<a class="sourceLine" id="cb7-18" data-line-number="18">  ]</a></code></pre></div>
<p>対応表は<a href="http://icfp16.sigplan.org/event/plmw-icfp-2016-some-types-of-types">このスライド</a>を参考にして証明が載ってそうな論文を探した(大変)．</p>
<p>これを参照して取ってくるように echo bot を書き換える． Haskell プログラミングはトップダウン．</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="ot">handleMessageEvent ::</span> <span class="dt">ReplyableEvent</span> <span class="dt">EventMessage</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">handleMessageEvent event <span class="fu">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">  <span class="kw">case</span> getMessage event <span class="kw">of</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4">    <span class="dt">TextEM</span> _ (<span class="dt">Text</span> text) <span class="ot">-&gt;</span> echo (getReplyToken event) (getCorrespondence text)</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">    _ <span class="ot">-&gt;</span> echo (getReplyToken event) <span class="st">&quot;undefined message&quot;</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="ot">getCorrespondence ::</span> <span class="dt">Text</span> <span class="ot">-&gt;</span> <span class="dt">Text</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8">getCorrespondence <span class="fu">=</span> undefined</a></code></pre></div>
<p>見つからない場合を考慮して分ける．</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="ot">getCorrespondence ::</span> <span class="dt">Text</span> <span class="ot">-&gt;</span> <span class="dt">Text</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">getCorrespondence <span class="fu">=</span> fromMaybe <span class="st">&quot;unknown...&quot;</span> <span class="fu">.</span> lookupCorrespondence</a>
<a class="sourceLine" id="cb9-3" data-line-number="3"></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="ot">lookupCorrespondence ::</span> <span class="dt">Text</span> <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">Text</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5">lookupCorrespondence txt <span class="fu">=</span> undefined</a></code></pre></div>
<p>あとは適当に</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="ot">lookupCorrespondence ::</span> <span class="dt">Text</span> <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">Text</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">lookupCorrespondence txt <span class="fu">=</span> msum <span class="fu">$</span> fmap match curryHowardCorrespondence</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4">    txt' <span class="fu">=</span> toLower txt</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">    match (as, bs, url)</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">      <span class="fu">|</span> any ((<span class="fu">==</span>) txt' <span class="fu">.</span> toLower) as <span class="fu">=</span> appendUrl url <span class="fu">&lt;$&gt;</span> safeHead bs</a>
<a class="sourceLine" id="cb10-7" data-line-number="7">      <span class="fu">|</span> any ((<span class="fu">==</span>) txt' <span class="fu">.</span> toLower) bs <span class="fu">=</span> appendUrl url <span class="fu">&lt;$&gt;</span> safeHead as</a>
<a class="sourceLine" id="cb10-8" data-line-number="8">      <span class="fu">|</span> otherwise <span class="fu">=</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="ot">appendUrl ::</span> <span class="dt">URL</span> <span class="ot">-&gt;</span> <span class="dt">Text</span> <span class="ot">-&gt;</span> <span class="dt">Text</span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11">appendUrl url <span class="fu">=</span> unwords <span class="fu">.</span> (<span class="fu">:</span> [url])</a>
<a class="sourceLine" id="cb10-12" data-line-number="12"></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="ot">safeHead ::</span> [a] <span class="ot">-&gt;</span> <span class="dt">Maybe</span> a</a>
<a class="sourceLine" id="cb10-14" data-line-number="14">safeHead <span class="fu">=</span> find (const <span class="dt">True</span>)</a></code></pre></div>
<p><code>toLower</code> してるのは英字の大文字小文字の違いを無視するため．</p>
<h2 id="実行">実行</h2>
<p><img src="../assets/curry-howard-linebot/demo.gif" /></p>
<h2 id="おしまい">おしまい</h2>
<p>一日ぐらいでサクッと作れた． LINE Bot に慣れたというのもあるが，それ以上にライブラリのおかげでしょう．</p>
<p>最初に <code>stack build</code> した時に，2,3個しか依存するライブラリ書いてないのに，100個ほどインストール(依存ライブラリに依存するライブラリを含む)されたときには，「巨人の肩に乗ってるなー」と感じた．</p>
  </div>
</div>
</article>

          </div>
        </div>

        <footer class="site-footer">

  <div class="wrapper">

    <span class="footer-heading">ひげメモ</span>

  </div>

  <div class="page-content card" style="display: flex; justify-content: center; padding: 5px 0px">
    <a href="https://haskell.jp/blog/posts/links.html#matsubara0507.github.io">
      <img width="234" src="https://haskell.jp/img/supported-by-haskell-jp.svg" alt="Supported By Haskell-jp.">
    </a>
  </div>

</footer>


      </div>
  </body>

</html>
